<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gew√§chshaus-Webapp</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-left">
                <h1><i class="fas fa-seedling"></i>Steuerbares Gew√§chshaus</h1>
                <p>Lernfeld 7 - Pr√§zisionsd√ºngung mit Einzelsteuerung</p>
            </div>
            <div class="header-right">
                <label class="dark-mode-switch" id="darkModeToggle">
                    <input type="checkbox" id="darkModeCheckbox">
                    <span class="slider">
                        <span class="slider-icon sun"><i class="fas fa-sun"></i></span>
                        <span class="slider-icon moon"><i class="fas fa-moon"></i></span>
                    </span>
                </label>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <aside class="control-panel">
                <section class="mode-selector">
                    <h2><i class="fas fa-toggle-on"></i> Betriebsmodus</h2>
                    <div class="mode-buttons">
                        <button id="viewMode" class="btn btn-primary mode-btn active">
                            <i class="fas fa-eye"></i> Ansicht
                        </button>
                        <button id="editMode" class="btn btn-secondary mode-btn">
                            <i class="fas fa-edit"></i> Editor
                        </button>
                    </div>
                </section>

                <section class="plant-management" id="plantManagement">
                    <h2><i class="fas fa-plus-circle"></i> Pflanze zum Hochbeet hinzuf√ºgen</h2>
                    <form id="plantForm">
                        <div class="form-group">
                            <label>Pflanzenart:</label>
                            <div class="plant-type-selector" id="plantTypeSelector">
                                <span class="selected-plant-icon" id="selectedPlantIcon">üå±</span>
                                <span class="selected-plant-name" id="selectedPlantName">Pflanze w√§hlen...</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <input type="hidden" id="plantName" required>
                            <input type="hidden" id="plantIcon">
                        </div>
                        <div class="form-group">
                            <label for="plantSlot">Hochbeet w√§hlen:</label>
                            <select id="plantSlot" required>
                                <option value="">Bitte w√§hlen...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="plantDate">Datum:</label>
                            <input type="date" id="plantDate">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Pflanze hinzuf√ºgen
                        </button>
                    </form>
                </section>

                <section class="map-editor hidden" id="mapEditor">
                    <h2><i class="fas fa-seedling"></i> Hochbeet-Editor</h2>
                    
                    <div class="editor-toolbar">
                        <div class="toolbar-group">
                            <button id="addZone" class="toolbar-btn add" title="Neues Hochbeet">
                                <i class="fas fa-plus"></i>
                                <span>Neues Beet</span>
                            </button>
                            <button id="deleteZone" class="toolbar-btn delete" title="Ausgew√§hltes Beet l√∂schen">
                                <i class="fas fa-trash-alt"></i>
                                <span>L√∂schen</span>
                            </button>
                        </div>
                        <div class="toolbar-hint">
                            <i class="fas fa-info-circle"></i>
                            Klicke auf die Karte um ein Beet zu platzieren
                        </div>
                    </div>
                    
                    <details class="accordion-card" open>
                        <summary class="accordion-summary"><i class="fas fa-sliders-h"></i> Beet-Eigenschaften</summary>
                        <div class="accordion-body">
                            <div class="control-group">
                                <label for="zoneSelector">Hochbeet ausw√§hlen:</label>
                                <select id="zoneSelector">
                                    <option value="">-- Bitte w√§hlen --</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="zoneName">Name:</label>
                                <input type="text" id="zoneName" placeholder="z.B. Gem√ºsebeet 1">
                            </div>
                            <div class="size-controls">
                                <div class="control-group">
                                    <label for="bedWidth">Breite:</label>
                                    <input type="range" id="bedWidth" min="15" max="50" value="30">
                                    <span id="bedWidthValue">30</span>
                                </div>
                                <div class="control-group">
                                    <label for="bedHeight">H√∂he:</label>
                                    <input type="range" id="bedHeight" min="10" max="40" value="20">
                                    <span id="bedHeightValue">20</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label for="bedColor">Rahmenfarbe:</label>
                                <div class="color-picker-row">
                                    <input type="color" id="bedColor" value="#8B4513">
                                    <div class="color-presets">
                                        <button class="color-preset" data-color="#8B4513" style="background:#8B4513" title="Holz"></button>
                                        <button class="color-preset" data-color="#5D4037" style="background:#5D4037" title="Dunkelbraun"></button>
                                        <button class="color-preset" data-color="#795548" style="background:#795548" title="Braun"></button>
                                        <button class="color-preset" data-color="#4E342E" style="background:#4E342E" title="Espresso"></button>
                                        <button class="color-preset" data-color="#6D4C41" style="background:#6D4C41" title="Kakao"></button>
                                    </div>
                                </div>
                            </div>
                            <button id="updateZone" class="btn btn-primary btn-block">
                                <i class="fas fa-save"></i> √Ñnderungen speichern
                            </button>
                        </div>
                    </details>
                    
                    <details class="accordion-card">
                        <summary class="accordion-summary"><i class="fas fa-tint"></i> Wassertank-Einstellungen</summary>
                        <div class="accordion-body">
                            <div class="control-group">
                                <label for="tankCapacity">Tank-Kapazit√§t (Liter):</label>
                                <input type="number" id="tankCapacity" min="100" max="10000" step="100" value="1000">
                            </div>
                            <div class="control-group">
                                <label for="tankCurrent">Aktueller F√ºllstand (Liter):</label>
                                <input type="number" id="tankCurrent" min="0" max="10000" step="10" value="750">
                            </div>
                            <button id="updateTank" class="btn btn-primary">
                                <i class="fas fa-save"></i> Tank aktualisieren
                            </button>
                        </div>
                    </details>
                    
                    <details class="accordion-card">
                        <summary class="accordion-summary"><i class="fas fa-network-wired"></i> NodeRED-Verbindung</summary>
                        <div class="accordion-body">
                            <div class="control-group">
                                <label for="nodeRedUrl">NodeRED WebSocket URL:</label>
                                <input type="text" id="nodeRedUrl" placeholder="ws://localhost:1880/ws" value="ws://localhost:1880/ws">
                            </div>
                            <div class="control-group">
                                <label>
                                    <input type="checkbox" id="nodeRedEnabled" checked>
                                    NodeRED aktivieren
                                </label>
                            </div>
                            <button id="connectNodeRed" class="btn btn-primary">
                                <i class="fas fa-plug"></i> Verbinden
                            </button>
                            <button id="disconnectNodeRed" class="btn btn-secondary">
                                <i class="fas fa-unlink"></i> Trennen
                            </button>
                        </div>
                    </details>

                    <details class="accordion-card" id="logsViewer">
                        <summary class="accordion-summary"><i class="fas fa-clipboard-list"></i> Logs</summary>
                        <div class="accordion-body">
                            <div class="control-group">
                                <label for="logLevelFilter">Level:</label>
                                <select id="logLevelFilter">
                                    <option value="">Alle</option>
                                    <option value="ERROR">ERROR</option>
                                    <option value="WARN">WARN</option>
                                    <option value="INFO">INFO</option>
                                    <option value="DEBUG">DEBUG</option>
                                </select>
                            </div>
                            <div class="editor-tools">
                                <button id="refreshLogs" class="btn btn-secondary">
                                    <i class="fas fa-sync"></i> Aktualisieren
                                </button>
                            </div>
                            <div id="logsContainer"></div>
                        </div>
                    </details>
                </section>

            </aside>

            <section class="map-container">
                <div class="map-header">
                    <h2><i class="fas fa-map"></i> Pflanzenkarte</h2>
                    <div class="map-controls">
                        <button id="zoomIn" class="btn btn-secondary">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button id="zoomOut" class="btn btn-secondary">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button id="resetView" class="btn btn-secondary">
                            <i class="fas fa-compress"></i> Reset
                        </button>
                        <button id="clearAll" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Alle l√∂schen
                        </button>
                    </div>
                </div>
                <div id="plantMap" class="plant-map">
                    <svg id="mapSvg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <!-- Gras-Hintergrund -->
                            <pattern id="grassPattern" width="4" height="4" patternUnits="userSpaceOnUse">
                                <rect width="4" height="4" fill="#90c469"/>
                                <circle cx="1" cy="1" r="0.3" fill="#7db356"/>
                                <circle cx="3" cy="2" r="0.2" fill="#a5d47e"/>
                                <circle cx="2" cy="3" r="0.25" fill="#7db356"/>
                            </pattern>
                            
                            <!-- Erde-Textur f√ºr Beete -->
                            <pattern id="soilPattern" width="3" height="3" patternUnits="userSpaceOnUse">
                                <rect width="3" height="3" fill="#5D4037"/>
                                <circle cx="0.5" cy="0.5" r="0.3" fill="#4E342E"/>
                                <circle cx="2" cy="1" r="0.25" fill="#6D4C41"/>
                                <circle cx="1" cy="2.2" r="0.35" fill="#4E342E"/>
                                <circle cx="2.5" cy="2.5" r="0.2" fill="#795548"/>
                            </pattern>
                            
                            <!-- Mulch-Textur -->
                            <pattern id="mulchPattern" width="4" height="4" patternUnits="userSpaceOnUse">
                                <rect width="4" height="4" fill="#3E2723"/>
                                <ellipse cx="1" cy="1" rx="0.6" ry="0.2" fill="#5D4037" transform="rotate(30 1 1)"/>
                                <ellipse cx="3" cy="2" rx="0.5" ry="0.15" fill="#4E342E" transform="rotate(-20 3 2)"/>
                                <ellipse cx="2" cy="3" rx="0.4" ry="0.2" fill="#6D4C41" transform="rotate(45 2 3)"/>
                            </pattern>
                            
                            <!-- Holzrahmen-Textur -->
                            <pattern id="woodPattern" width="2" height="1" patternUnits="userSpaceOnUse">
                                <rect width="2" height="1" fill="#8B4513"/>
                                <line x1="0" y1="0.3" x2="2" y2="0.3" stroke="#A0522D" stroke-width="0.1"/>
                                <line x1="0" y1="0.7" x2="2" y2="0.7" stroke="#6B3E0A" stroke-width="0.1"/>
                            </pattern>
                            
                            <!-- Schatten-Filter -->
                            <filter id="bedShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0.5" dy="0.5" stdDeviation="0.8" flood-color="#000" flood-opacity="0.3"/>
                            </filter>
                            
                            <!-- Pflanzensymbole -->
                            <symbol id="plantIcon" viewBox="0 0 10 10">
                                <path d="M5 9 L5 5 M3 6 Q5 4 7 6 M2 7 Q5 3 8 7" fill="none" stroke="#2E7D32" stroke-width="0.8" stroke-linecap="round"/>
                                <circle cx="5" cy="4" r="1.5" fill="#4CAF50"/>
                            </symbol>
                            <symbol id="tomatoIcon" viewBox="0 0 10 10">
                                <circle cx="5" cy="5.5" r="3" fill="#e53935"/>
                                <path d="M4 3 L5 2 L6 3" fill="#4CAF50"/>
                            </symbol>
                            <symbol id="carrotIcon" viewBox="0 0 10 10">
                                <path d="M5 2 L6.5 8 L5 9 L3.5 8 Z" fill="#FF9800"/>
                                <path d="M4 2 Q5 1 6 2" fill="none" stroke="#4CAF50" stroke-width="0.5"/>
                            </symbol>
                            <symbol id="saladIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="6" rx="3.5" ry="2.5" fill="#8BC34A"/>
                                <ellipse cx="5" cy="5" rx="2.5" ry="2" fill="#9CCC65"/>
                                <ellipse cx="5" cy="4.5" rx="1.5" ry="1.2" fill="#AED581"/>
                            </symbol>
                            <symbol id="cucumberIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="5" rx="1.8" ry="3.5" fill="#689F38"/>
                                <ellipse cx="5" cy="5" rx="1.2" ry="2.8" fill="#7CB342"/>
                            </symbol>
                            <symbol id="pepperIcon" viewBox="0 0 10 10">
                                <path d="M5 2 L5 3" stroke="#4CAF50" stroke-width="0.8"/>
                                <path d="M3.5 4 Q3 6 4 8 Q5 9 6 8 Q7 6 6.5 4 Q5 3 3.5 4" fill="#F44336"/>
                            </symbol>
                            <symbol id="onionIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="6" rx="2.5" ry="2.8" fill="#FFCC80"/>
                                <path d="M5 3 L5 2 M4 3.5 L4 2.5 M6 3.5 L6 2.5" stroke="#8BC34A" stroke-width="0.5"/>
                            </symbol>
                            <symbol id="potatoIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="5.5" rx="3" ry="2.2" fill="#8D6E63"/>
                                <circle cx="4" cy="5" r="0.4" fill="#6D4C41"/>
                                <circle cx="6" cy="6" r="0.3" fill="#6D4C41"/>
                            </symbol>
                            <symbol id="basilIcon" viewBox="0 0 10 10">
                                <path d="M5 9 L5 5" stroke="#5D4037" stroke-width="0.5"/>
                                <ellipse cx="4" cy="4" rx="1.5" ry="1" fill="#388E3C" transform="rotate(-30 4 4)"/>
                                <ellipse cx="6" cy="4" rx="1.5" ry="1" fill="#43A047" transform="rotate(30 6 4)"/>
                                <ellipse cx="5" cy="3" rx="1.2" ry="0.8" fill="#4CAF50"/>
                            </symbol>
                            <symbol id="mintIcon" viewBox="0 0 10 10">
                                <path d="M5 9 L5 4" stroke="#5D4037" stroke-width="0.4"/>
                                <ellipse cx="3.5" cy="5" rx="1.2" ry="0.8" fill="#26A69A" transform="rotate(-20 3.5 5)"/>
                                <ellipse cx="6.5" cy="5" rx="1.2" ry="0.8" fill="#26A69A" transform="rotate(20 6.5 5)"/>
                                <ellipse cx="4" cy="3.5" rx="1" ry="0.7" fill="#4DB6AC" transform="rotate(-30 4 3.5)"/>
                                <ellipse cx="6" cy="3.5" rx="1" ry="0.7" fill="#4DB6AC" transform="rotate(30 6 3.5)"/>
                            </symbol>
                            <symbol id="parsleyIcon" viewBox="0 0 10 10">
                                <path d="M5 9 L5 5" stroke="#5D4037" stroke-width="0.4"/>
                                <path d="M3 4 Q4 3 5 4 Q6 3 7 4" fill="none" stroke="#2E7D32" stroke-width="0.8"/>
                                <path d="M3.5 3 Q4.5 2 5 3 Q5.5 2 6.5 3" fill="none" stroke="#388E3C" stroke-width="0.6"/>
                            </symbol>
                            <symbol id="rosemaryIcon" viewBox="0 0 10 10">
                                <path d="M5 9 L5 2" stroke="#5D4037" stroke-width="0.5"/>
                                <path d="M4 7 L3 6.5 M6 7 L7 6.5 M4 5.5 L3 5 M6 5.5 L7 5 M4 4 L3 3.5 M6 4 L7 3.5" stroke="#2E7D32" stroke-width="0.8"/>
                            </symbol>
                            <symbol id="thymeIcon" viewBox="0 0 10 10">
                                <path d="M5 9 L5 3" stroke="#795548" stroke-width="0.4"/>
                                <g fill="#558B2F">
                                    <circle cx="4" cy="4" r="0.6"/><circle cx="6" cy="4" r="0.6"/>
                                    <circle cx="3.5" cy="5.5" r="0.5"/><circle cx="6.5" cy="5.5" r="0.5"/>
                                    <circle cx="4" cy="7" r="0.5"/><circle cx="6" cy="7" r="0.5"/>
                                </g>
                            </symbol>
                            <symbol id="chiveIcon" viewBox="0 0 10 10">
                                <path d="M3 9 Q3 5 4 2 M5 9 Q5 4 5 2 M7 9 Q7 5 6 2" stroke="#7CB342" stroke-width="0.6" fill="none"/>
                            </symbol>
                            <symbol id="strawberryIcon" viewBox="0 0 10 10">
                                <path d="M4 3 L5 2 L6 3" fill="#4CAF50"/>
                                <path d="M3 4 Q2 6 3 8 Q5 9.5 7 8 Q8 6 7 4 Q5 3 3 4" fill="#E53935"/>
                                <circle cx="4" cy="5.5" r="0.3" fill="#FFEB3B"/><circle cx="6" cy="6" r="0.3" fill="#FFEB3B"/>
                                <circle cx="5" cy="7" r="0.3" fill="#FFEB3B"/>
                            </symbol>
                            <symbol id="zucchiniIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="5" rx="1.5" ry="3.5" fill="#558B2F"/>
                                <path d="M5 1.5 L5 1" stroke="#8BC34A" stroke-width="0.8"/>
                            </symbol>
                            <symbol id="beanIcon" viewBox="0 0 10 10">
                                <path d="M3 3 Q2 5 3 7 Q4 8 5 7 Q6 8 7 7 Q8 5 7 3 Q5 2 3 3" fill="#689F38"/>
                            </symbol>
                            <symbol id="peaIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="5" rx="3.5" ry="1.8" fill="#7CB342"/>
                                <circle cx="3.5" cy="5" r="1" fill="#8BC34A"/><circle cx="5" cy="5" r="1" fill="#9CCC65"/>
                                <circle cx="6.5" cy="5" r="1" fill="#8BC34A"/>
                            </symbol>
                            <symbol id="radishIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="6" rx="2" ry="2.5" fill="#E91E63"/>
                                <path d="M5 3 L5 2 M4 3.5 L3.5 2" stroke="#4CAF50" stroke-width="0.5"/>
                            </symbol>
                            <symbol id="cabbageIcon" viewBox="0 0 10 10">
                                <circle cx="5" cy="5.5" r="3" fill="#7CB342"/>
                                <circle cx="5" cy="5.5" r="2" fill="#8BC34A"/>
                                <circle cx="5" cy="5.5" r="1" fill="#9CCC65"/>
                            </symbol>
                            <symbol id="broccoliIcon" viewBox="0 0 10 10">
                                <rect x="4.5" y="6" width="1" height="3" fill="#5D4037"/>
                                <circle cx="3.5" cy="4.5" r="1.5" fill="#388E3C"/>
                                <circle cx="6.5" cy="4.5" r="1.5" fill="#388E3C"/>
                                <circle cx="5" cy="3.5" r="1.8" fill="#43A047"/>
                            </symbol>
                            <symbol id="cornIcon" viewBox="0 0 10 10">
                                <ellipse cx="5" cy="5" rx="1.8" ry="3" fill="#FDD835"/>
                                <path d="M3 3 Q2 2 3 1 M7 3 Q8 2 7 1" stroke="#7CB342" stroke-width="0.5" fill="none"/>
                            </symbol>
                            <symbol id="sunflowerIcon" viewBox="0 0 10 10">
                                <circle cx="5" cy="5" r="1.5" fill="#5D4037"/>
                                <g fill="#FDD835">
                                    <ellipse cx="5" cy="2" rx="0.8" ry="1.5"/>
                                    <ellipse cx="5" cy="8" rx="0.8" ry="1.5"/>
                                    <ellipse cx="2" cy="5" rx="1.5" ry="0.8"/>
                                    <ellipse cx="8" cy="5" rx="1.5" ry="0.8"/>
                                </g>
                            </symbol>
                        </defs>
                        
                        <!-- Gras-Hintergrund -->
                        <rect width="100" height="100" fill="url(#grassPattern)" />
                        
                        <!-- Subtiles Grid -->
                        <g opacity="0.15">
                            <line x1="0" y1="25" x2="100" y2="25" stroke="#fff" stroke-width="0.2"/>
                            <line x1="0" y1="50" x2="100" y2="50" stroke="#fff" stroke-width="0.2"/>
                            <line x1="0" y1="75" x2="100" y2="75" stroke="#fff" stroke-width="0.2"/>
                            <line x1="25" y1="0" x2="25" y2="100" stroke="#fff" stroke-width="0.2"/>
                            <line x1="50" y1="0" x2="50" y2="100" stroke="#fff" stroke-width="0.2"/>
                            <line x1="75" y1="0" x2="75" y2="100" stroke="#fff" stroke-width="0.2"/>
                        </g>
                        
                        <!-- Hochbeete-Gruppe -->
                        <g id="zonesGroup"></g>
                        
                        <!-- Pflanzen-Gruppe -->
                        <g id="plantsGroup"></g>
                    </svg>
                </div>
                <div class="plant-search-container">
                    <div class="plant-search-input">
                        <i class="fas fa-search"></i>
                        <input type="text" id="plantSearchGlobal" placeholder="Pflanze suchen..." autocomplete="off">
                        <button class="search-clear hidden" id="searchClearBtn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="plant-search-results hidden" id="plantSearchResults"></div>
                </div>
            </section>

            <aside class="right-panel">
                <section class="fertilizer-control">
                    <h2><i class="fas fa-flask"></i> D√ºngerkontrolle</h2>
                    <div id="selectedPlantInfo" class="hidden">
                        <h3>Ausgew√§hlte Hochbeete</h3>
                        <div class="plant-details">
                            <p><strong>Beete:</strong> <span id="selectedPlantType"></span></p>
                            <p><strong>Anzahl:</strong> <span id="selectedPlantPosition"></span></p>
                            <p><strong>Letzte Auswahl:</strong> <span id="selectedPlantDate"></span></p>
                        </div>
                        
                        <div class="fertilizer-inputs">
                            <div class="form-group">
                                <label for="nitrogen">Stickstoff (N) in kg/ha:</label>
                                <input type="number" id="nitrogen" min="0" max="500" step="0.1" value="0">
                            </div>
                            <div class="form-group">
                                <label for="phosphorus">Phosphor (P) in kg/ha:</label>
                                <input type="number" id="phosphorus" min="0" max="200" step="0.1" value="0">
                            </div>
                            <div class="form-group">
                                <label for="potassium">Kalium (K) in kg/ha:</label>
                                <input type="number" id="potassium" min="0" max="300" step="0.1" value="0">
                            </div>
                            <button id="applyFertilizer" class="btn btn-success">
                                <i class="fas fa-spray-can"></i> D√ºnger anwenden
                            </button>
                        </div>
                    </div>
                    <div id="noPlantSelected">
                        <p><i class="fas fa-info-circle"></i> Bitte w√§hlen Sie ein oder mehrere Hochbeete auf der Karte aus (Shift f√ºr Mehrfachauswahl).</p>
                    </div>
                </section>

                <section class="statistics">
                    <h2><i class="fas fa-chart-bar"></i> Statistik</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" id="totalPlants">0</span>
                            <span class="stat-label">Pflanzen</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalNitrogen">0</span>
                            <span class="stat-label">N (kg)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalPhosphorus">0</span>
                            <span class="stat-label">P (kg)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalPotassium">0</span>
                            <span class="stat-label">K (kg)</span>
                        </div>
                    </div>
                </section>
            </aside>

        </div>
        
        <!-- Hochbeet-Details Panel (volle Breite unter der Karte) -->
        <section class="bed-details-fullwidth" id="bedDetailsSection">
            <div class="bed-details-header">
                <div class="bed-info" id="inlinePlantInfo">
                    <h2 id="inlinePlantName"><i class="fas fa-seedling"></i> Kein Hochbeet ausgew√§hlt</h2>
                    <div class="bed-stats">
                        <span class="stat"><i class="fas fa-leaf"></i> <span id="inlinePlantPosition">0</span> Pflanzen</span>
                        <span class="stat"><i class="fas fa-list-check"></i> <span id="inlinePlantDate">0</span> Todos</span>
                    </div>
                </div>
                <div class="bed-hint" id="noInlinePlantSelected">
                    <i class="fas fa-mouse-pointer"></i> Klicke auf ein Hochbeet um Details zu sehen. <strong>Shift+Klick</strong> um Pflanzen zu platzieren.
                </div>
            </div>
            
            <div id="inlineContent" class="bed-details-content hidden">
                <div class="bed-details-grid">
                    <!-- Pflanzen Spalte -->
                    <div class="bed-column plants-column">
                        <div class="column-header">
                            <h3><i class="fas fa-leaf"></i> Pflanzen</h3>
                            <button class="btn btn-success btn-sm" id="openPlantPickerBtn" title="Pflanze hinzuf√ºgen">
                                <i class="fas fa-plus"></i> Pflanze
                            </button>
                        </div>
                        <div id="inlineBedPlantsList" class="items-list"></div>
                    </div>
                    
                    <!-- Todos Spalte -->
                    <div class="bed-column todos-column">
                        <div class="column-header">
                            <h3><i class="fas fa-list-check"></i> Todos</h3>
                        </div>
                        <div class="add-form">
                            <div class="form-inline">
                                <input type="text" id="inlineTodoText" placeholder="Todo eingeben...">
                                <input type="date" id="inlineTodoDate">
                                <select id="inlineTodoPriority">
                                    <option value="low">Niedrig</option>
                                    <option value="medium" selected>Mittel</option>
                                    <option value="high">Hoch</option>
                                </select>
                                <button id="inlineAddTodo" class="btn btn-success btn-icon" title="Hinzuf√ºgen">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div id="inlineBedTodosList" class="items-list"></div>
                    </div>
                    
                    <!-- D√ºnger Spalte -->
                    <div class="bed-column fertilizer-column">
                        <div class="column-header">
                            <h3><i class="fas fa-flask"></i> D√ºngerstatus</h3>
                        </div>
                        <div class="fertilizer-stats" id="bedFertilizerStats">
                            <div class="fert-stat">
                                <span class="fert-label">Stickstoff (N)</span>
                                <div class="fert-bar"><div class="fert-fill n" id="fertN" style="width: 0%"></div></div>
                                <span class="fert-value" id="fertNValue">0 kg/ha</span>
                            </div>
                            <div class="fert-stat">
                                <span class="fert-label">Phosphor (P)</span>
                                <div class="fert-bar"><div class="fert-fill p" id="fertP" style="width: 0%"></div></div>
                                <span class="fert-value" id="fertPValue">0 kg/ha</span>
                            </div>
                            <div class="fert-stat">
                                <span class="fert-label">Kalium (K)</span>
                                <div class="fert-bar"><div class="fert-fill k" id="fertK" style="width: 0%"></div></div>
                                <span class="fert-value" id="fertKValue">0 kg/ha</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Wassertank - Moderne Anzeige (volle Breite) -->
        <section class="water-tank-modern">
            <div class="tank-modern-grid">
                <!-- Haupt-Tankvisualisierung -->
                <div class="tank-visual-modern">
                    <div class="tank-glass">
                        <div class="tank-water-fill" id="tankWater">
                            <div class="water-surface"></div>
                            <div class="water-bubbles">
                                <span></span><span></span><span></span><span></span><span></span>
                            </div>
                        </div>
                        <div class="tank-scale">
                            <span data-level="100"></span>
                            <span data-level="75"></span>
                            <span data-level="50"></span>
                            <span data-level="25"></span>
                        </div>
                    </div>
                    <div class="tank-label">Wassertank</div>
                </div>
                
                <!-- Stats Cards -->
                <div class="tank-stats">
                    <div class="tank-stat-card main">
                        <div class="stat-icon"><i class="fas fa-tint"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="tankPercentage">75%</div>
                            <div class="stat-label">F√ºllstand</div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-bar-fill" id="tankBarFill" style="width: 75%"></div>
                        </div>
                    </div>
                    
                    <div class="tank-stat-card">
                        <div class="stat-icon volume"><i class="fas fa-cube"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="tankVolume">750L</div>
                            <div class="stat-label">von 1000L</div>
                        </div>
                    </div>
                    
                    <div class="tank-stat-card">
                        <div class="stat-icon temp"><i class="fas fa-thermometer-half"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="waterTemp">18¬∞C</div>
                            <div class="stat-label">Wassertemperatur</div>
                        </div>
                    </div>
                    
                    <div class="tank-stat-card">
                        <div class="stat-icon time"><i class="fas fa-clock"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="lastUpdate">vor 5 Min.</div>
                            <div class="stat-label">Letzte Messung</div>
                        </div>
                    </div>
                </div>
                
                <!-- Status Indicator -->
                <div class="tank-status-modern">
                    <div class="status-indicator" id="tankStatusIndicator">
                        <i class="fas fa-check-circle" id="warningIcon"></i>
                        <span id="warningText">Normal</span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Sensor-Dashboard (volle Breite unter der Karte) -->
        <section class="sensor-dashboard-fullwidth">
            <div class="sensor-dashboard-header">
                <h2><i class="fas fa-microchip"></i> Sensor-Dashboard</h2>
                <div class="sensor-dashboard-controls">
                    <div class="connection-status" id="nodeRedStatus">
                        <i class="fas fa-circle" id="statusIcon"></i>
                        <span id="statusText">Verbinden...</span>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="system.exportSensorData()">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="system.reconnectNodeRed()">
                        <i class="fas fa-sync"></i>
                    </button>
                </div>
            </div>
            
            <!-- Sensoren Zeile -->
            <div class="sensors-row">
                <div class="sensor-card-compact" id="tempCard">
                    <div class="sensor-icon temp"><i class="fas fa-thermometer-half"></i></div>
                    <div class="sensor-info">
                        <div class="sensor-value"><span id="tempValue">22.5</span><span class="unit">¬∞C</span></div>
                        <div class="sensor-label">Temperatur</div>
                    </div>
                    <div class="sensor-trend" id="tempTrend"><i class="fas fa-arrow-up"></i></div>
                </div>
                
                <div class="sensor-card-compact" id="humidityCard">
                    <div class="sensor-icon humidity"><i class="fas fa-tint"></i></div>
                    <div class="sensor-info">
                        <div class="sensor-value"><span id="humidityValue">65</span><span class="unit">%</span></div>
                        <div class="sensor-label">Luftfeuchtigkeit</div>
                    </div>
                    <div class="sensor-trend" id="humidityTrend"><i class="fas fa-minus"></i></div>
                </div>
                
                <div class="sensor-card-compact" id="soilMoistureCard">
                    <div class="sensor-icon soil"><i class="fas fa-seedling"></i></div>
                    <div class="sensor-info">
                        <div class="sensor-value"><span id="soilMoistureValue">42</span><span class="unit">%</span></div>
                        <div class="sensor-label">Bodenfeuchtigkeit</div>
                    </div>
                    <div class="sensor-trend" id="soilMoistureTrend"><i class="fas fa-minus"></i></div>
                </div>
            </div>
            
            <!-- Graphen Zeile -->
            <div class="graphs-row">
                <div class="graph-card-compact" data-sensor="temperature">
                    <div class="graph-header">
                        <span class="graph-title">Temperatur</span>
                        <div class="time-slider-container">
                            <div class="time-slider-track">
                                <div class="time-slider-thumb" data-pos="0"></div>
                            </div>
                            <div class="time-slider-labels">
                                <button class="time-btn active" data-range="1h">1h</button>
                                <button class="time-btn" data-range="6h">6h</button>
                                <button class="time-btn" data-range="24h">24h</button>
                            </div>
                        </div>
                    </div>
                    <canvas id="tempGraph"></canvas>
                </div>
                
                <div class="graph-card-compact" data-sensor="humidity">
                    <div class="graph-header">
                        <span class="graph-title">Luftfeuchtigkeit</span>
                        <div class="time-slider-container">
                            <div class="time-slider-track">
                                <div class="time-slider-thumb" data-pos="0"></div>
                            </div>
                            <div class="time-slider-labels">
                                <button class="time-btn active" data-range="1h">1h</button>
                                <button class="time-btn" data-range="6h">6h</button>
                                <button class="time-btn" data-range="24h">24h</button>
                            </div>
                        </div>
                    </div>
                    <canvas id="humidityGraph"></canvas>
                </div>
                
                <div class="graph-card-compact" data-sensor="soilMoisture">
                    <div class="graph-header">
                        <span class="graph-title">Bodenfeuchtigkeit</span>
                        <div class="time-slider-container">
                            <div class="time-slider-track">
                                <div class="time-slider-thumb" data-pos="0"></div>
                            </div>
                            <div class="time-slider-labels">
                                <button class="time-btn active" data-range="1h">1h</button>
                                <button class="time-btn" data-range="6h">6h</button>
                                <button class="time-btn" data-range="24h">24h</button>
                            </div>
                        </div>
                    </div>
                    <canvas id="soilMoistureGraph"></canvas>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2026 Lernfeld 7 - Steuerbare D√ºngeanlage | Pr√§zisionslandwirtschaft</p>
    </footer>

    <!-- Plant Picker Modal -->
    <div class="modal-overlay hidden" id="plantPickerModal">
        <div class="modal-content plant-picker-modal">
            <div class="modal-header">
                <h3><i class="fas fa-seedling"></i> Pflanze hinzuf√ºgen</h3>
                <button class="modal-close" id="closePlantPickerModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="plant-picker-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="plantSearchInput" placeholder="Pflanze suchen...">
                </div>
                <div class="plant-picker-categories" id="plantPickerCategories"></div>
                <div class="plant-picker-grid" id="plantPickerGrid"></div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
